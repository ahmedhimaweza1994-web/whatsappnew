u are an expert full-stack developer building a WhatsApp Export Viewer web app in Replit. The user has imported a previous version of the app code, but it's buggy. Start fresh: Explain your plan, then generate/fix the complete codebase using Next.js/React/Tailwind for a production-ready app. Be creative in architecture but fix all issues exactly. Use the provided .txt example for testing.

### App Overview
Build "WhatsApp Archive Viewer": A web app for viewing official WhatsApp chat exports (.zip files from "Export Chat > Include Media"). Users signup/login (custom auth), upload .zip, which contains .txt (messages) + media (images/videos/voice notes). Parse to display chats exactly like WhatsApp Web: Green theme (#075E54), sidebar for chats, bubble messages (right for "You", left for others), inline media, timestamps, search, galleries, PDF exports. Fully offline/local after upload (IndexedDB for data/media).

Full Features:
- Custom Auth: Email/password signup/login (bcrypt hash, JWT tokens with secret). No Replit Authâ€”remove it completely. Protect routes (e.g., dashboard).
- Upload: Drag-drop .zip only. Extract .txt + media (JSZip). Parse .txt to JSON chats/messages.
- Sidebar: Chat list (from multiple zips), search, pin/archive, unread badges.
- Chat Window: Bubbles with text/emojis/links, timestamps (HH:MM, date separators), media inline (img/audio/video), gallery button.
- Extras: Global search (fuzzy), export PDF/JSON (react-pdf), dark mode, PWA offline.

UI/UX: 100% WhatsApp cloneâ€”responsive (mobile: hamburger sidebar, full chat; desktop: side-by-side). RTL for Arabic, LTR for English (auto-detect).

### Previous Issues (Fix These â€“ Test with Example .txt Below)
The imported code has bugs from Arabic export testing:
1. **Garbled Chat Name**: Filename like "Ø¯Ø±Ø¯Ø´Ø© ÙÙŠ ÙˆØ§ØªØ³Ø§Ø¨ Ù…Ø¹ +20 15 01018144.txt" shows as "Ã¢Â€ÂÃ˜Â¯Ã˜Â±Ã˜Â¯Ã˜Â´Ã˜Â© Ã™ÂÃ™ÂŠ Ã™ÂˆÃ˜Â§Ã˜ÂªÃ˜Â³Ã˜Â§Ã˜Â¨ Ã™Â…Ã˜Â¹ Ã¢Â€ÂÃ¢Â€Âª+20 15 01018144Ã¢Â€Â¬Ã¢Â€Â" or "/1/4) AJ H'*3'( E9 *+966 54 943 4931,". Cause: UTF-8/RTL marks not cleaned.
2. **No Messages Shown**: "No messages in this chat" despite content. Parser fails on Arabic: Eastern numerals (Ù Ù¡Ù¢Ù£Ù¤Ù¥Ù¦Ù§Ù¨Ù©), Arabic comma (ØŒ), RTL marks (\u200F), multi-line bodies, first line ignored.
3. **No Media**: Zip media (e.g., IMG-*.jpg, PTT-*.opus) not extracted/matched to "<ØªÙ… Ø§Ø³ØªØ¨Ø¹Ø§Ø¯ Ø§Ù„ÙˆØ³Ø§Ø¦Ø·>" placeholders. No inline display/gallery.

Example .txt Content (Test With This â€“ Simulate in Zip):
Ù¡Ù¥â€/Ù¡Ù â€/Ù¢Ù Ù¢Ù¥ØŒ Ù§:Ù¤Ù  Ù… - â€Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ÙˆØ§Ù„Ù…ÙƒØ§Ù„Ù…Ø§Øª Ù…Ø´ÙØ±Ø© ØªÙ…Ø§Ù…Ù‹Ø§ Ø¨ÙŠÙ† Ø§Ù„Ø·Ø±ÙÙŠÙ†. ÙˆÙŠÙ…ÙƒÙ† Ù„Ù„Ø£Ø´Ø®Ø§Øµ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ† ÙÙ‚Ø· ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ù‚Ø±Ø§Ø¡ØªÙ‡Ø§ Ø£Ùˆ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ø¥Ù„ÙŠÙ‡Ø§ Ø£Ùˆ Ù…Ø´Ø§Ø±ÙƒØªÙ‡Ø§. ØªØ¹Ø±Ù‘Ù Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø²ÙŠØ¯.
Ù¢Ù¥â€/Ù¡Ù â€/Ù¢Ù Ù¢Ù¥ØŒ Ù¡Ù :Ù Ù¡ Ù… - Eugene Prime: Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ…
Ù¢Ù¥â€/Ù¡Ù â€/Ù¢Ù Ù¢Ù¥ØŒ Ù¡Ù :Ù Ù¢ Ù… - Eugene Prime: Ù…Ø±ÙˆØ§Ù† Ø§Ø®Ø¨Ø§Ø±Ùƒ Ø§ÙŠÙ‡
Ù¢Ù¥â€/Ù¡Ù â€/Ù¢Ù Ù¢Ù¥ØŒ Ù¡Ù :Ù Ù¢ Ù… - Eugene Prime: Ø§Ø®Ø¨Ø§Ø±Ùƒ Ø§ÙŠÙ‡ ÙŠØ§ Ø®Ø§Ù„Ùˆ Ø§Ø­Ø³Ù† ğŸ˜‚
Ù¢Ù¥â€/Ù¡Ù â€/Ù¢Ù Ù¢Ù¥ØŒ Ù¡Ù :Ù¢Ù¢ Ù… - â€â€ª+20 15 01018144â€¬â€: <ØªÙ… Ø§Ø³ØªØ¨Ø¹Ø§Ø¯ Ø§Ù„ÙˆØ³Ø§Ø¦Ø·>
Ù¢Ù¥â€/Ù¡Ù â€/Ù¢Ù Ù¢Ù¥ØŒ Ù¡Ù :Ù¢Ù¢ Ù… - â€â€ª+20 15 01018144â€¬â€: <ØªÙ… Ø§Ø³ØªØ¨Ø¹Ø§Ø¯ Ø§Ù„ÙˆØ³Ø§Ø¦Ø·>
Ù¢Ù¥â€/Ù¡Ù â€/Ù¢Ù Ù¢Ù¥ØŒ Ù¡Ù :Ù¢Ù¥ Ù… - Eugene Prime: ÙƒÙ„Ù‡ ØªÙ…Ø§Ù… ÙŠØ§ Ù…Ø¯ÙŠØ±
Ù¢Ù¥â€/Ù¡Ù â€/Ù¢Ù Ù¢Ù¥ØŒ Ù¡Ù :Ù¢Ù¥ Ù… - Eugene Prime: ÙƒÙ†Øª Ø¹Ø§ÙˆØ²Ùƒ ØªØ¨Ø¹ØªÙŠ Ø§Ù„ ai tools Ø§Ù„Ù„ÙŠ ÙƒÙ†Øª Ù‡ØªØ³ØªØ®Ø¯Ù…Ù‡Ø§ ÙÙŠ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
Ù¢Ù¥â€/Ù¡Ù â€/Ù¢Ù Ù¢Ù¥ØŒ Ù¡Ù :Ù¢Ù¥ Ù… - Eugene Prime: Ø®Ù„ÙŠÙ†Ø§ Ù†ÙÙŠØ¯ Ø¨Ø¹Ø¶
Ù¢Ù¥â€/Ù¡Ù â€/Ù¢Ù Ù¢Ù¥ØŒ Ù¡Ù :Ù¢Ù§ Ù… - â€â€ª+20 15 01018144â€¬â€: <ØªÙ… Ø§Ø³ØªØ¨Ø¹Ø§Ø¯ Ø§Ù„ÙˆØ³Ø§Ø¦Ø·>
Ù£Ù â€/Ù¡Ù â€/Ù¢Ù Ù¢Ù¥ØŒ Ù¡Ù :Ù¤Ù£ Øµ - â€â€ª+20 15 01018144â€¬â€: Ø§Ù„Ù Ø§Ù„Ù Ø³Ù„Ø§Ù…Ø© Ø¹Ù„ÙŠÙ‡Ø§ ÙŠØ§Ø±Ø¨ ÙˆØªÙ‚ÙˆÙ… Ø¨Ø§Ù„Ø³Ù„Ø§Ù…Ø© ÙˆØªØ¨Ù‚ÙŠ Ø§Ø­Ø³Ù† Ù…Ù† Ø§Ù„Ø§ÙˆÙ„
Ø±Ø¨Ù†Ø§ ÙŠØ´ÙÙŠÙ‡Ø§ ÙŠØ§Ø±Ø¨
Ù£Ù â€/Ù¡Ù â€/Ù¢Ù Ù¢Ù¥ØŒ Ù¡Ù :Ù¤Ù¤ Øµ - Eugene Prime: Ø§Ù† Ø´Ø§Ø¡ Ø§Ù„Ù„Ù‡ ÙŠØ³Ù…Ø¹ Ù…Ù†Ùƒ Ø±Ø¨Ù†Ø§ , Ø´ÙƒØ±Ø§ ÙŠØ§ Ù…Ø±ÙˆØ§Ù† ØªØ³Ù„Ù…Ù„ÙŠ ÙŠØ§ Ø­Ø¨ÙŠØ¨ÙŠ
Ù£Ù â€/Ù¡Ù â€/Ù¢Ù Ù¢Ù¥ØŒ Ù¡Ù :Ù¤Ù¦ Øµ - â€â€ª+20 15 01018144â€¬â€: Ø­Ø¨ÙŠØ¨ÙŠ Ø¹Ù„ÙŠ Ø§ÙŠØ©
Ø±Ø¨Ù†Ø§ ÙŠØ¨Ø§Ø±ÙƒÙ„Ùƒ ÙÙŠÙ‡Ø§ ÙˆÙŠØ®Ù„ÙŠÙ‡Ø§ ÙŠØ§Ø±Ø¨ ÙˆÙŠØ´ÙÙŠÙ‡Ø§
Ù£Ù â€/Ù¡Ù â€/Ù¢Ù Ù¢Ù¥ØŒ Ù¡Ù :Ù¤Ù¦ Øµ - Eugene Prime: Ø§Ù† Ø´Ø§Ø¡ Ø§Ù„Ù„Ù‡
textExpected Output: ~14 messages, clean name "Ø¯Ø±Ø¯Ø´Ø© ÙÙŠ ÙˆØ§ØªØ³Ø§Ø¨ Ù…Ø¹ +20 15 01018144", media placeholders matched to zip files (e.g., PTT.opus at 10:22 Ù…).

### Fixes to Implement (Directly in Code)
1. **Zip Upload/Extraction**: Single .zip upload. JSZip to extract .txt (read as UTF-8 TextDecoder), media as blobs/URLs (store in IndexedDB). Error if no .txt.
2. **Parser Fixes**:
   - Clean line: replace RTL marks (/[\u200E\u200F\u202A-\u202E]/g, ''), convert Eastern nums ('Ù Ù¡Ù¢Ù£Ù¤Ù¥Ù¦Ù§Ù¨Ù©' -> '0123456789' via map/replace).
   - Skip first line if 'Ù…Ø´ÙØ±Ø©'.
   - Regex: /^(\d{1,2}\/\d{1,2}\/\d{4}ØŒ \d{1,2}:\d{2} [Ù…|Øµ] - )(.+): (.*)$/ after cleaning â€“ capture timestamp, sender, body.
   - Multi-line: Append non-matching lines to prev body.
   - Media: For "<ØªÙ… Ø§Ø³ØªØ¨Ø¹Ø§Ø¯ Ø§Ù„ÙˆØ³Ø§Ø¦Ø·>", parse timestamp to YYYYMMDD, match zip files (e.g., "IMG-YYYYMMDD-WA*.jpg"), add {media: {type: 'image', url: blobUrl}}.
3. **Chat Name**: From .txt filename, clean RTL/encoding, extract "Ø¯Ø±Ø¯Ø´Ø© Ù…Ø¹ [number]".
4. **Arabic/English**: dir="rtl" for Arabic (detect by script), date-fns locale.
5. **Responsive**: Tailwind/media queries â€“ mobile: sidebar hidden/hamburger, chat flex-col.
6. **Auth**: Custom only â€“ bcrypt/JWT (use .env JWT_SECRET). Signup/login forms, protected routes.
7. **Media Display**: Inline <img>/<audio>/<video>, gallery grid.

Tech Stack: Next.js, Tailwind, JSZip, bcryptjs, jsonwebtoken, dexie (IndexedDB), date-fns, react-pdf. Add npm i if needed.

Plan: 1. Outline fixes. 2. Generate full code (files: app/layout.js, auth/, upload/route.js, parser.js, components/Chat.js). 3. Test: "Simulate zip with example .txt + dummy media, show 14 msgs/media."

Build nowâ€”make it flawless!